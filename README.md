Refactored and name-appropriate code from McMillan
